Testing set_general_nftables() with default config (wan enabled, IPv4).

-- Testcase --
import m from 'mwan4';
m.set_scriptname('test');
m.init();
m.set_general_nftables();
print(global.mocklib.read_captured('/usr/share/nftables.d/ruleset-post/10-mwan4-base.nft'));
-- End --

-- Expect stdout --
table inet fw4 {

	set mwan4_connected_ipv4 {
		type ipv4_addr
		flags interval
		auto-merge
	}

	set mwan4_custom_ipv4 {
		type ipv4_addr
		flags interval
		auto-merge
	}

	set mwan4_dynamic_ipv4 {
		type ipv4_addr
		flags interval
		auto-merge
	}

	set mwan4_connected_ipv6 {
		type ipv6_addr
		flags interval
		auto-merge
	}

	set mwan4_custom_ipv6 {
		type ipv6_addr
		flags interval
		auto-merge
	}

	set mwan4_dynamic_ipv6 {
		type ipv6_addr
		flags interval
		auto-merge
	}

	chain mwan4_ifaces_in {
	}

	chain mwan4_rules_ipv4 {
	}

	chain mwan4_rules_ipv6 {
	}

	chain mwan4_rules {
		ip jump mwan4_rules_ipv4
		ip6 jump mwan4_rules_ipv6
	}

	chain mwan4_prerouting {
		type filter hook prerouting priority mangle; policy accept;
		ip6 nexthdr icmpv6 icmpv6 type {
			nd-router-solicit,
			nd-router-advert,
			nd-neighbor-solicit,
			nd-neighbor-advert,
			nd-redirect
		} return
		ct mark & 0x3f00 != 0 meta mark set (meta mark & ~0x3f00) | (ct mark & 0x3f00)
		meta mark & 0x3f00 == 0 jump mwan4_ifaces_in
		meta mark & 0x3f00 == 0 ip daddr @mwan4_custom_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip daddr @mwan4_connected_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip daddr @mwan4_dynamic_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip6 daddr @mwan4_custom_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip6 daddr @mwan4_connected_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip6 daddr @mwan4_dynamic_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 jump mwan4_rules
		ct mark set (ct mark & ~0x3f00) | (meta mark & 0x3f00)
		meta mark & 0x3f00 != 0x3f00 ip daddr @mwan4_custom_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip daddr @mwan4_connected_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip daddr @mwan4_dynamic_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip6 daddr @mwan4_custom_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip6 daddr @mwan4_connected_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip6 daddr @mwan4_dynamic_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
	}

	chain mwan4_output {
		type route hook output priority mangle; policy accept;
		ip6 nexthdr icmpv6 icmpv6 type {
			nd-router-solicit,
			nd-router-advert,
			nd-neighbor-solicit,
			nd-neighbor-advert,
			nd-redirect
		} return
		ct mark & 0x3f00 != 0 meta mark set (meta mark & ~0x3f00) | (ct mark & 0x3f00)
		meta mark & 0x3f00 == 0 jump mwan4_ifaces_in
		meta mark & 0x3f00 == 0 ip daddr @mwan4_custom_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip daddr @mwan4_connected_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip daddr @mwan4_dynamic_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip6 daddr @mwan4_custom_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip6 daddr @mwan4_connected_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 ip6 daddr @mwan4_dynamic_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 == 0 jump mwan4_rules
		ct mark set (ct mark & ~0x3f00) | (meta mark & 0x3f00)
		meta mark & 0x3f00 != 0x3f00 ip daddr @mwan4_custom_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip daddr @mwan4_connected_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip daddr @mwan4_dynamic_ipv4 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip6 daddr @mwan4_custom_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip6 daddr @mwan4_connected_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
		meta mark & 0x3f00 != 0x3f00 ip6 daddr @mwan4_dynamic_ipv6 meta mark set (meta mark & ~0x3f00) | 0x3f00
	}
}
-- End --
